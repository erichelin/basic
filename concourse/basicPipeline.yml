---
resources:

- name: git
  type: git
  source:
    uri: https://github.com/ehelin/basic.git

- name: deployLocation
  type: cf
  source:
    api: XXXXXXXXXXXXXX
    username: XXXXXXXXXXX
    password: XXXXXXXXXXX
    organization: XXXXXXXXXXXX
    space: dev
    skip_cert_check: false

jobs:
- name: build
  plan:
  - get: git
    trigger: true
  - task: unit-tests
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: node, "7.4.0"}
      inputs:
      - name: git
        path: pre-build-directory
      outputs:
      - name: post-build
      run:
        path: sh
        args:
           - -exc
           - |
             ls
             cd pre-build-directory
             npm install
             npm test
             ls
             cd ..
             cp -LR pre-build-directory/* post-build
             cd post-build
             ls
             cd concourse
             ls
             echo [All Done!]
  - aggregate:
      - put: deployLocation
        params:
          manifest: post-build/concourse/manifest-dev.yml
          path: post-build/